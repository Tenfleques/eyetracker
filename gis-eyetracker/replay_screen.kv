#:kivy 1.1.0

<ReplayScreen>:
    main_view_parent:main_view_parent
    lbl_input_dir:lbl_input_dir
    btn_play: btn_play
    replay_video_canvas:replay_video_canvas
    video_progress: video_progress
    # txt_box_step_size: txt_box_step_size
    txt_box_replay_video_speed:txt_box_replay_video_speed
    frame_details: frame_details
    chkbx_bg_is_grab:chkbx_bg_is_grab
    chkbx_maintain_track:chkbx_maintain_track
    chkbx_camera_track:chkbx_camera_track
    chkbx_tracker_track:chkbx_tracker_track
    chkbx_video_track:chkbx_video_track
    # chkbx_use_optimal_step: chkbx_use_optimal_step
    video_export_progress:video_export_progress
    # tabbed_main_view:tabbed_main_view
    # tabbed_timeline_item:tabbed_timeline_item
    BoxLayout:
        orientation: 'vertical'
        id: main_view_parent
        BackgroundGridLayout:
            rows: 3
            cols: 1
            TabbedPanel:
                id: tabbed_main_view
                do_default_tab: False
                TabbedPanelItem:
                    id: tabbed_timeline_item_video
                    markup:True
                    text: "[b]" + root.get_local_str("_timeline_stage") + "[/b]"
                    BackgroundBoxLayout:
                        orientation: 'vertical'
                        BackgroundGridLayout:
                            cols:2
                            BackgroundGridLayout:
                                rows:1
                                cols: 3
                                background_color: (0, .196, .313, 1)
                                BackgroundBoxLayout:
                                    orientation: 'vertical'
                                    ResultVideoCanvas:
                                        id: replay_video_canvas
                                        size_hint_y: 1
                                        allow_stretch:True
                                        keep_ratio:False
                                        pos_hint:{'x':.0, 'y':.0}
                                GridLayout:
                                    size_hint_y: 1
                                    size_hint_x: None
                                    width: 1
                                BackgroundGridLayout:
                                    rows: 3
                                    size_hint_x: .3
                                    BackgroundGridLayout:
                                        rows: 2
                                        background_color: (.6, .6, .6, 1)
                                        BoxLayout:
                                            orientation: 'horizontal'
                                            size_hint_y: None
                                            height: 30
                                            padding: [0, 0, 0, 0]
                                            NormalLabel:
                                                markup:True
                                                text: "[b]" + root.get_local_str("_camera_feed") + "[/b]"
                                            CheckBox:
                                                id:chkbx_camera_track
                                                size_hint: (None, None)
                                                height: 25
                                                width: 50
                                                color: [0,0,0,1]
                                                state: 'down'
                                                margin: [0, 0, 0, 0]
                                           
                                        Image:
                                            id: camera_feed_image
                                            allow_stretch:True
                                            size_hint_x: 1
                                            keep_ratio:False
                                            pos_hint:{'x':.0, 'y':.0}
                                    Image:
                                        id: pos_feed_image
                                        size_hint_x: 1
                                        allow_stretch:True
                                        keep_ratio:False
                                        pos_hint:{'x':.0, 'y':.0}
                                    Image:
                                        id: origin_feed_image
                                        size_hint_x: 1
                                        allow_stretch:True
                                        keep_ratio:False
                                        pos_hint:{'x':.0, 'y':.0}
                                    

                            BackgroundGridLayout:
                                cols:1
                                rows:3
                                size_hint_x: None
                                width: 280
                                background_color: (.6, .6, .6, 1)
                                padding: [2, 0, 0, 0]
                                GridLayout:
                                    rows: 2
                                    NormalLabel:
                                        markup:True
                                        text: "[b]" + root.get_local_str("_frame_details") + "[/b]"
                                    FrameDetails:
                                        id: frame_details
                                BackgroundGridLayout:
                                    rows:1
                                    size_hint_y: None
                                    height:2
                                    padding: [10, 0, 0, 10]
                                    background_color: (0, .196, .313, 1)
                                BackgroundGridLayout:
                                    background_color: (1, 1, 1, 1)
                                    rows: 5
                                    size_hint_y: None
                                    height: 200
                                    padding: [0, 10, 0, 0]
                                    GridLayout:
                                        rows: 2
                                        size_hint_y: None
                                        height: 80
                                        GridLayout:
                                            rows: 2
                                            halign: 'right'
                                            size_hint_y: None
                                            height: 50
                                            padding: [5, 0, 5, 0]
                                            GridLayout:
                                                cols: 2
                                                halign: 'right'
                                                size_hint_y: None
                                                height: 30
                                                padding: [0, 0, 0, 0]
                                                GridLayout:
                                                    rows: 2
                                                    padding: [0, 5, 5, 0]
                                                    
                                                NormalButton:
                                                    id: export_video
                                                    text: root.get_local_str("_export_video")
                                                    on_release: root.btn_export_video_click()
                                                    size_hint_x: None
                                                    width: '220dp'
                                            ProgressBar:
                                                id:video_export_progress
                                                value: 0
                                                max: 100
                                            
                                        GridLayout:
                                            cols: 2
                                            NormalLabel:
                                                id:lbl_tracker_track
                                                text: root.get_local_str("_tracker_track")
                                                color: [0, 0, 0, 1]
                                                size_hint_x: .6
                                                size_hint_y: None
                                                height: 20
                                                halign: 'left'
                                            CheckBox:
                                                id: chkbx_tracker_track
                                                size_hint: (None, None)
                                                color: [0,0,0,1]
                                                size_hint_y: None
                                                height: 20
                                                state: 'down'
                                    GridLayout:
                                        cols: 2
                                        size_hint_y: None
                                        height: 30
                                        NormalLabel:
                                            id:lbl_video_track
                                            text: root.get_local_str("_video_track")
                                            color: [0,0,0,1]
                                            size_hint_x: .6
                                            size_hint_y: None
                                            height: 20
                                            halign: 'left'
                                        CheckBox:
                                            id:chkbx_video_track
                                            size_hint: (None, None)
                                            color: [0,0,0,1]
                                            size_hint_y: None
                                            height: 20
                                            state: 'down'
                                    GridLayout:
                                        cols: 2
                                        size_hint_y: None
                                        height: 30
                                        NormalLabel:
                                            id:lbl_bg_is_grab
                                            text: root.get_local_str("_bg_is_grab")
                                            color: [0,0,0,1]
                                            size_hint_x: .6
                                            size_hint_y: None
                                            height: 20
                                            halign: 'left'
                                        CheckBox:
                                            id:chkbx_bg_is_grab
                                            size_hint: (None, None)
                                            color: [0,0,0,1]
                                            size_hint_y: None
                                            height: 20
                                    GridLayout:
                                        cols: 2
                                        size_hint_y: None
                                        height: 30
                                        NormalLabel:
                                            id:lbl_maintain_track
                                            text: root.get_local_str("_maintain_track")
                                            color: [0,0,0,1]
                                            size_hint_x: .6
                                            size_hint_y: None
                                            height: 20
                                            halign: 'left'
                                        CheckBox:
                                            id:chkbx_maintain_track
                                            size_hint: (None, None)
                                            color: [0,0,0,1]
                                            size_hint_y: None
                                            height: 20
                        BackgroundGridLayout:
                            rows:1
                            size_hint_y: None
                            height:1
                            background_color: (0, .196, .313, 1)

                        Slider:
                            id: video_progress
                            value: 0
                            min: 0
                            size_hint_y: None
                            size_y: 1
                            value_track:True
                            value_track_color:[1, 0, 0, 1]
                            cursor_size: ['10sp', '10sp']
                            cursor_image: ''
                            value_track_width: '2.5sp'
                TabbedPanelItem:
                    id: tabbed_timeline_item_table
                    markup:True
                    text: "[b]" + root.get_local_str("_tl_table") + "[/b]"
                    Table:
                        id: tl_table
                TabbedPanelItem:
                    id: tabbed_timeline_item_charts
                    markup:True
                    text: "[b]" + root.get_local_str("_tl_charts") + "[/b]"

            BackgroundGridLayout:
                rows:1
                size_hint_y: None
                height:2
                background_color: (0, .196, .313, 1)

            BackgroundGridLayout:
                rows:1
                cols:2
                size_hint_y: None
                height: 130
                background_color: (.9, .9, .9, .9)
                GridLayout:
                    rows:3
                    id: main
                    size_hint_x: .6
                    padding: [5, 5, 5, 5]
                    GridLayout:
                        rows: 1
                        cols: 2
                        size_hint_y: None
                        height:40
                        id: file_ops
                        NormalLabel:
                            id:lbl_input_dir
                            text: root.get_default_from_prev_session('lbl_input_dir', root.get_local_str("_directory_not_selected"))
                        NormalButton:
                            text: root.get_local_str("_select_directory")
                            on_release: root.show_load()
                            size_hint: (None, None)
                            width: '250dp'
                            height: '25dp'
                    GridLayout:
                        rows: 1
                        id: neighborhood_sessions
                        SelectBox:
                            id: select_box_neighboring_sessions
                            text: root.get_local_str("_other_sessions")
                            background_normal: ''
                            background_color: (.8, .8, .8, 1)
                            color:(0,0,0,1)
                            size_hint_y: None
                            height: 25
                            multiline:False
                            font_size: dp(13)
                        Label:
                            text: ''
                            size_hint: (None, None)
                            width: '250dp'
                            height: '25dp'
                    # GridLayout:
                    #     halign: 'right'
                    #     cols: 2
                    #     GridLayout:
                    #         rows: 1
                    #         padding: [0, 5, 0, 0]
                    #         NormalLabel:
                    #             id:lbl_use_optimal_step
                    #             text: root.get_local_str("_use_optimal_step")
                    #             color: [0,0,0,1]
                    #             size_hint_y: None
                    #             height: 20
                    #             halign: 'left'
                    #         CheckBox:
                    #             id:chkbx_use_optimal_step
                    #             size_hint: (None, None)
                    #             color: [0,0,0,1]
                    #             size_hint_y: None
                    #             # size_hint_x: None
                    #             # width: 15
                    #             height: 15
                    #             state: 'down'
                    #     GridLayout:
                    #         rows: 2
                    #         padding: [5, 5, 5, 5]
                    #         size_hint_x: None
                    #         width: '250dp'
                    #         IntegerInput:
                    #             id: txt_box_replay_frame_step
                    #             text: root.get_default_from_prev_session('txt_box_frame_step',"1")
                    #             size_hint_y: None
                    #             height: 25
                    #             multiline:False
                    #             font_size: dp(13)
                    #         NormalLabel:
                    #             text: root.get_local_str("_frame_step")
                GridLayout:
                    id: tools_pane
                    size_hint_x: .4
                    rows: 2
                    padding: [5, 5, 5, 5]
                    GridLayout:
                        rows: 1
                        size_hint_y: None
                        height:45
                        background_color: (.9, .9, .9, 1)
                        GridLayout:
                            rows: 1
                            halign: 'left'
                            padding: [0, 5, 0, 0]
                            NormalButton:
                                id: btn_play
                                size_hint_x: 1
                                text: root.get_local_str("_start")
                                on_release: root.btn_play_click()
                        GridLayout:
                            rows: 1
                            halign: 'right'
                            padding: [5, 5, 5, 5]
                            NormalButton:
                                id: btn_stop
                                size_hint_x: 1
                                text: root.get_local_str("_stop")
                                on_release: root.btn_stop_click()

                        GridLayout:
                            rows: 1
                            halign: 'left'
                            padding: [0, 5, 0, 5]
                            NormalButton:
                                id: btn_step_backward
                                size_hint_x: 1
                                text: root.get_local_str("_step_back")
                                on_release: root.btn_step_backward_click()
                        
                        GridLayout:
                            rows: 1
                            halign: 'right'
                            padding: [5, 5, 0, 0]
                            NormalButton:
                                id: btn_step_forward
                                size_hint_x: 1
                                text: root.get_local_str("_step_forward")
                                on_release: root.btn_step_forward_click()

                    GridLayout:
                        rows: 1
                        GridLayout:
                            cols: 2
                            padding: [0, 0, 0, 0]
                            size_hint_x: .5
                            GridLayout:
                                rows:2
                                padding: [0, 0, 0, 0]
                                SelectBox:
                                    id: select_box_replay_speed
                                    text: "1x"
                                    background_normal: ''
                                    background_color: (.8, .8, .8, 1)
                                    color:(0,0,0,1)
                                    size_hint_y: None
                                    height: 25
                                    multiline:False
                                    font_size: dp(13)
                            GridLayout:
                                rows:2
                                padding: [5, 0, 5, 0]
                                FloatInput:
                                    id: txt_box_replay_video_speed
                                    text: "1"
                                    size_hint: (.8, None)
                                    height: 25
                                    multiline:False
                                    font_size: dp(13)
                                NormalLabel:
                                    text: root.get_local_str("_video_fps")
                        
                        GridLayout:
                            rows: 2
                            padding: [0, 0, 0, 0]
                            size_hint_x: .5
                            IntegerInput:
                                id: txt_box_step_size
                                text: root.get_default_from_prev_session('txt_box_step_size',"10")
                                size_hint: (.8, None)
                                height: 25
                                multiline:False
                                font_size: dp(13)
                            NormalLabel:
                                text: root.get_local_str("_step_size")
